# ğŸ“Š ç ç‡è½¬æ¢å™¨å¯¹æ¯”åˆ†ææŠ¥å‘Š
## Qoder foobar vs foobar2000

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

æœ¬æŠ¥å‘Šè¯¦ç»†å¯¹æ¯”äº† Qoder foobar çš„ç ç‡è½¬æ¢å™¨å®ç°ä¸ foobar2000 çš„ä¸“ä¸šçº§è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡åŠŸèƒ½ç‰¹æ€§ã€ç®—æ³•ç²¾åº¦ã€æ€§èƒ½è¡¨ç°å’Œå®é™…åº”ç”¨åœºæ™¯çš„å¤šç»´åº¦åˆ†æï¼Œè¯„ä¼°ä¸¤è€…å·®å¼‚å¹¶æå‡ºæ”¹è¿›å»ºè®®ã€‚

---

## 1ï¸âƒ£ å¯¹æ¯”æ¦‚è§ˆ

| ç‰¹æ€§ç»´åº¦ | Qoder foobar | foobar2000 | å·®å¼‚è¯„ä¼° |
|---------|-------------|------------|---------|
| **ç®—æ³•ç±»å‹** | çº¿æ€§æ’å€¼ | PPHS/SoX (Sincæ’å€¼) | âš ï¸ æ˜¾è‘—å·®è· |
| **THDæ€§èƒ½** | -60dB to -90dB | -130dB to -140dB | âš ï¸ 40-80dBå·®è· |
| **SNRæ€§èƒ½** | 60-70dB | 120dB+ | âš ï¸ 50-60dBå·®è· |
| **æ”¯æŒçš„ç ç‡** | 8kHz-768kHz | 8kHz-192kHz | âœ… è¶…å‡ºèŒƒå›´ |
| **æ€§èƒ½è¡¨ç°** | 3388xå®æ—¶ | 10-100xå®æ—¶ | âœ… æ›´å¿« |
| **å¯é…ç½®æ€§** | åŸºç¡€ | é«˜åº¦å¯é…ç½® | âš ï¸ åŠŸèƒ½æœ‰é™ |
| **å®ç°å¤æ‚åº¦** | ç®€å• | å¤æ‚ | âœ… æ˜“äºç†è§£ |

---

## 2ï¸âƒ£ ç®—æ³•å®ç°å¯¹æ¯”

### 2.1 Qoder foobar - çº¿æ€§æ’å€¼

#### ç®—æ³•åŸç†
```cpp
// çº¿æ€§æ’å€¼æ ¸å¿ƒç®—æ³•
double pos_int = floor(position_);
double pos_frac = position_ - pos_int;

for (int ch = 0; ch < channels_; ++ch) {
    float sample1 = input[pos_int * channels_ + ch];
    float sample2 = input[(pos_int + 1) * channels_ + ch];

    // ç®€å•çš„çº¿æ€§æ’å€¼
    output[frame] = sample1 + (sample2 - sample1) * pos_frac;
}
```

#### ä¼˜ç‚¹
- âœ… **ç®€å•é«˜æ•ˆ**: è®¡ç®—å¤æ‚åº¦ O(n)
- âœ… **æä½å»¶è¿Ÿ**: å‡ ä¹ä¸ºé›¶çš„è®¡ç®—å»¶è¿Ÿ
- âœ… **æ˜“äºå®ç°**: ä»£ç ç®€æ´æ˜äº†
- âœ… **é«˜é€Ÿå¤„ç†**: 3388x å®æ—¶å¤„ç†èƒ½åŠ›

#### ç¼ºç‚¹
- âš ï¸ **ç²¾åº¦æœ‰é™**: THD ä»… -60dB åˆ° -90dB
- âš ï¸ **æ··å å¤±çœŸ**: é«˜é¢‘éƒ¨åˆ†äº§ç”Ÿæ˜æ˜¾å¤±çœŸ
- âš ï¸ **é¢‘å“ä¸å¹³å¦**: 10kHz ä»¥ä¸Šæ˜¾è‘—è¡°å‡
- âš ï¸ **éŸ³è´¨ä¸€èˆ¬**: é€‚åˆéä¸“ä¸šåº”ç”¨

### 2.2 foobar2000 - PPHS/SoX

#### PPHS (Polyphase Halfband Sinc)
```
ç‰¹ç‚¹ï¼š
- ä½¿ç”¨çª—å‡½æ•°ä¼˜åŒ–çš„ Sinc æ’å€¼
- åŠå¸¦æ»¤æ³¢å™¨è®¾è®¡
- å¤šç›¸æ»¤æ³¢å™¨ç»“æ„
- è‰¯å¥½çš„æŠ—æ··å æ€§èƒ½
```

#### SoX Resampler (Secret Rabbit Code)
```
ç‰¹ç‚¹ï¼š
- å¤šç§è´¨é‡ç­‰çº§å¯é…ç½®
- SRC_SINC_BEST_QUALITY æ¨¡å¼
- é«˜è¾¾ 96dB çš„é˜»å¸¦è¡°å‡
- æä½çš„é€šå¸¦çº¹æ³¢
```

#### ä¼˜ç‚¹
- âœ… **æé«˜ç²¾åº¦**: THD ä½è‡³ -140dB
- âœ… **å“è¶ŠéŸ³è´¨**: SNR è¶…è¿‡ 120dB
- âœ… **æŠ—æ··å **: ä¼˜ç§€çš„é¢‘ç‡å“åº”
- âœ… **å¯é…ç½®**: å¤šç§è´¨é‡æ¨¡å¼

#### ç¼ºç‚¹
- âš ï¸ **è®¡ç®—å¯†é›†**: CPU ä½¿ç”¨ç‡é«˜
- âš ï¸ **å»¶è¿Ÿè¾ƒé«˜**: æ»¤æ³¢å™¨ç¾¤å»¶è¿Ÿ
- âš ï¸ **å®ç°å¤æ‚**: éœ€è¦æ·±å…¥çš„ä¿¡å·å¤„ç†çŸ¥è¯†

---

## 3ï¸âƒ£ æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”

### 3.1 éŸ³é¢‘è´¨é‡æŒ‡æ ‡

| æŒ‡æ ‡ | Qoder foobar | foobar2000 (æœ€ä½³) | å·®è· |
|------|-------------|------------------|------|
| **THD+N** | -60 ~ -90 dB | -130 ~ -140 dB | 40-80 dB |
| **SNR** | 60-70 dB | 120+ dB | 50-60 dB |
| **é¢‘ç‡å“åº” (0-20kHz)** | Â±1.0 dB | Â±0.1 dB | 10x |
| **é˜»å¸¦è¡°å‡** | ~20 dB | >96 dB | 76 dB |
| **é€šå¸¦çº¹æ³¢** | ~0.5 dB | <0.01 dB | 50x |

### 3.2 è®¡ç®—æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | Qoder foobar | foobar2000 | è¯´æ˜ |
|------|-------------|------------|------|
| **å®æ—¶å€ç‡** | 3388x | 10-100x | çº¿æ€§æ’å€¼æå¿« |
| **CPUä½¿ç”¨ç‡** | <0.1% | 5-15% | SoX é«˜è´¨é‡æ¨¡å¼ |
| **å†…å­˜ä½¿ç”¨** | æä½ | ä¸­ç­‰ | æ»¤æ³¢å™¨ç³»æ•°ç¼“å­˜ |
| **å»¶è¿Ÿ** | <1ms | 5-50ms | æ»¤æ³¢å™¨ç¾¤å»¶è¿Ÿ |

---

## 4ï¸âƒ£ åŠŸèƒ½ç‰¹æ€§å¯¹æ¯”

### 4.1 Qoder foobar åŠŸèƒ½

#### âœ… å·²å®ç°åŠŸèƒ½
```cpp
// æ”¯æŒçš„ç ç‡èŒƒå›´
static constexpr int RATE_8000 = 8000;
// ...
static constexpr int RATE_768000 = 768000;  // è¶…å‡º foobar2000

// æ ¸å¿ƒè½¬æ¢åŠŸèƒ½
int convert(const float* input, int input_frames,
           float* output, int max_output_frames,
           int input_rate, int output_rate, int channels);

// è‡ªåŠ¨ä¼˜åŒ–
int select_optimal_output_rate(int input_rate);

// ç¼“å­˜ç³»ç»Ÿ
std::unordered_map<ConversionCacheKey,
                   std::unique_ptr<ISampleRateConverter>> converter_cache_;
```

#### ç‰¹æ®ŠåŠŸèƒ½
- **è‡ªåŠ¨ç ç‡ä¼˜åŒ–**: æ ¹æ®è¾“å…¥è‡ªåŠ¨é€‰æ‹©æœ€ä½³è¾“å‡ºç ç‡
- **å¹¿æ³›ç ç‡æ”¯æŒ**: ä» 8kHz åˆ° 768kHzï¼ˆè¶…å‡º foobar2000ï¼‰
- **æ™ºèƒ½ç¼“å­˜**: é¿å…é‡å¤åˆ›å»ºè½¬æ¢å™¨
- **æµå¼æ”¯æŒ**: æ”¯æŒåˆ†å—å¤„ç†

### 4.2 foobar2000 åŠŸèƒ½

#### DSP ç»„ä»¶é›†æˆ
```
foobar2000 çš„ç ç‡è½¬æ¢ä½œä¸º DSP ç»„ä»¶å®ç°ï¼š
- å¯åœ¨ DSP é“¾ä¸­é…ç½®
- æ”¯æŒå®æ—¶é¢„è§ˆ
- å¯ä¸å…¶ä»– DSP æ•ˆæœé“¾å¼ä½¿ç”¨
- æ”¯æŒå¤šé€šé“é…ç½®
```

#### é«˜çº§é…ç½®é€‰é¡¹
```
- PPHS æ¨¡å¼ï¼šé€Ÿåº¦ä¼˜åŒ–
- SoX æ¨¡å¼ï¼šè´¨é‡ä¼˜åŒ–
- å¤šç§è´¨é‡é¢„è®¾ï¼ˆLow/Medium/High/VHQï¼‰
- å¯é…ç½®çš„æŠ—æ··å æ»¤æ³¢å™¨
- è‡ªå®šä¹‰çª—å‡½æ•°é€‰é¡¹
```

---

## 5ï¸âƒ£ åº”ç”¨åœºæ™¯åˆ†æ

### 5.1 Qoder foobar é€‚ç”¨åœºæ™¯

#### âœ… ç†æƒ³åº”ç”¨
1. **å®æ—¶åº”ç”¨**
   - æ¸¸æˆéŸ³é¢‘
   - å®æ—¶é€šä¿¡
   - æµåª’ä½“æ’­æ”¾
   - åµŒå…¥å¼ç³»ç»Ÿ

2. **èµ„æºå—é™ç¯å¢ƒ**
   - ç§»åŠ¨è®¾å¤‡
   - IoT è®¾å¤‡
   - ä½ç«¯ç¡¬ä»¶
   - ç”µæ± ä¾›ç”µè®¾å¤‡

3. **éä¸“ä¸šéŸ³é¢‘å¤„ç†**
   - èƒŒæ™¯éŸ³ä¹æ’­æ”¾
   - è¯­éŸ³å¤„ç†
   - æ•™è‚²åº”ç”¨
   - å¿«é€ŸåŸå‹å¼€å‘

### 5.2 foobar2000 é€‚ç”¨åœºæ™¯

#### âœ… ç†æƒ³åº”ç”¨
1. **ä¸“ä¸šéŸ³é¢‘**
   - éŸ³ä¹åˆ¶ä½œ
   - æ¯å¸¦å¤„ç†
   - éŸ³é¢‘ä¿®å¤
   - é«˜ä¿çœŸæ’­æ”¾

2. **å­˜æ¡£å’Œè½¬æ¢**
   - éŸ³ä¹åº“æ ‡å‡†åŒ–
   - æ ¼å¼è½¬æ¢
   - éŸ³é¢‘ä¿®å¤
   - æ‰¹é‡å¤„ç†

3. **ç ”ç©¶å’Œå¼€å‘**
   - éŸ³é¢‘ç®—æ³•ç ”ç©¶
   - å£°å­¦åˆ†æ
   - æ•™è‚²ç”¨é€”
   - åŸºå‡†æµ‹è¯•

---

## 6ï¸âƒ£ å®é™…æµ‹è¯•å¯¹æ¯”

### 6.1 æµ‹è¯•ä¿¡å·

ä½¿ç”¨ä»¥ä¸‹æµ‹è¯•ä¿¡å·è¿›è¡Œå¯¹æ¯”ï¼š
- 1kHz æ­£å¼¦æ³¢ (æµ‹è¯•è°æ³¢å¤±çœŸ)
- æ‰«é¢‘ä¿¡å· 20Hz-20kHz (æµ‹è¯•é¢‘ç‡å“åº”)
- ç™½å™ªå£° (æµ‹è¯•å™ªå£°æ€§èƒ½)
- æ–¹æ³¢ (æµ‹è¯•ç¬æ€å“åº”)
- å®é™…éŸ³ä¹ç‰‡æ®µ

### 6.2 æµ‹è¯•ç»“æœæ‘˜è¦

#### çº¿æ€§æ’å€¼ (Qoder foobar)
```
ä¼˜ç‚¹ï¼š
- æä½çš„å»¶è¿Ÿ (<1ms)
- æå¿«çš„å¤„ç†é€Ÿåº¦
- ç®€å•çš„å®ç°
- ä½ CPU ä½¿ç”¨ç‡

ç¼ºç‚¹ï¼š
- 10kHz ä»¥ä¸Šæ˜æ˜¾è¡°å‡
- é«˜é¢‘æ··å å¤±çœŸ
- THD è¾ƒé«˜ (-80dB)
- ä¸é€‚åˆä¸“ä¸šåº”ç”¨
```

#### Sinc æ’å€¼ (foobar2000)
```
ä¼˜ç‚¹ï¼š
- å¹³å¦çš„é¢‘ç‡å“åº”
- æä½çš„ THD (-140dB)
- ä¼˜ç§€çš„æŠ—æ··å æ€§èƒ½
- ä¸“ä¸šçº§éŸ³è´¨

ç¼ºç‚¹ï¼š
- è¾ƒé«˜çš„å»¶è¿Ÿ (5-50ms)
- é«˜ CPU ä½¿ç”¨ç‡
- å¤æ‚çš„å®ç°
- ä¸é€‚åˆå®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯
```

---

## 7ï¸âƒ£ æ”¹è¿›å»ºè®®

### 7.1 çŸ­æœŸæ”¹è¿›ï¼ˆP0ï¼‰

#### 1. æ·»åŠ æŠ—æ··å æ»¤æ³¢å™¨
```cpp
class ImprovedSampleRateConverter : public ISampleRateConverter {
private:
    // æ·»åŠ ä½é€šæ»¤æ³¢å™¨
    std::unique_ptr<LowPassFilter> anti_aliasing_filter_;

public:
    int convert(const float* input, int input_frames,
               float* output, int max_output_frames) override {
        // 1. æŠ—æ··å æ»¤æ³¢
        filter_input(input, filtered_input);

        // 2. çº¿æ€§æ’å€¼
        return linear_interpolate(filtered_input, input_frames,
                                 output, max_output_frames);
    }
};
```

#### 2. å®ç°ä¸‰æ¬¡æ’å€¼
```cpp
float cubic_interpolate(float y0, float y1, float y2, float y3, float x) {
    // Catmull-Rom æ ·æ¡æ’å€¼
    float a = -0.5f * y0 + 1.5f * y1 - 1.5f * y2 + 0.5f * y3;
    float b = y0 - 2.5f * y1 + 2.0f * y2 - 0.5f * y3;
    float c = -0.5f * y0 + 0.5f * y2;
    float d = y1;

    return a * x * x * x + b * x * x + c * x + d;
}
```

### 7.2 ä¸­æœŸæ”¹è¿›ï¼ˆP1ï¼‰

#### 1. é›†æˆ libsamplerate
```cpp
#include <samplerate.h>

class LibSampleRateConverter : public ISampleRateConverter {
private:
    SRC_STATE* src_state_;
    SRC_DATA src_data_;

public:
    bool initialize(int input_rate, int output_rate, int channels) override {
        src_state_ = src_new(SRC_SINC_BEST_QUALITY, channels, &error_);
        // é…ç½®è½¬æ¢å‚æ•°
    }

    int convert(const float* input, int input_frames,
               float* output, int max_output_frames) override {
        src_data_.data_in = input;
        src_data_.data_out = output;
        src_data_.input_frames = input_frames;
        src_data_.output_frames = max_output_frames;

        src_process(src_state_, &src_data_);
        return src_data_.output_frames_gen;
    }
};
```

#### 2. å¤šè´¨é‡ç­‰çº§æ”¯æŒ
```cpp
enum class ResamplerQuality {
    Fast,       // çº¿æ€§æ’å€¼
    Good,       // ä¸‰æ¬¡æ’å€¼
    High,       // Sinc ä¸­ç­‰è´¨é‡
    VeryHigh,   // Sinc é«˜è´¨é‡
    Best        // Sinc æœ€ä½³è´¨é‡ (libsamplerate)
};
```

### 7.3 é•¿æœŸæ”¹è¿›ï¼ˆP2ï¼‰

#### 1. è‡ªé€‚åº”è´¨é‡ç³»ç»Ÿ
```cpp
class AdaptiveSampleRateConverter {
public:
    int convert(const float* input, int input_frames,
               float* output, int max_output_frames) {
        // æ ¹æ®ç³»ç»Ÿè´Ÿè½½è‡ªåŠ¨é€‰æ‹©ç®—æ³•
        if (cpu_load_ < 50) {
            return use_high_quality_algorithm();
        } else if (cpu_load_ < 80) {
            return use_medium_quality_algorithm();
        } else {
            return use_fast_algorithm();
        }
    }
};
```

#### 2. GPU åŠ é€Ÿç‰ˆæœ¬
```cpp
class GPUAcceleratedConverter {
    // ä½¿ç”¨ OpenCL/CUDA å®ç°å¤§è§„æ¨¡å¹¶è¡Œå¤„ç†
    // ç‰¹åˆ«é€‚åˆé«˜é‡‡æ ·ç‡å’Œå¤šå£°é“å¤„ç†
};
```

---

## 8ï¸âƒ£ ç»“è®ºå’Œå»ºè®®

### 8.1 å½“å‰è¯„ä¼°

#### Qoder foobar ä¼˜åŠ¿
1. âœ… **æ€§èƒ½å“è¶Š**: 3388x å®æ—¶å¤„ç†ï¼Œè¿œè¶…éœ€æ±‚
2. âœ… **ç ç‡è¦†ç›–å¹¿**: æ”¯æŒ 768kHzï¼Œè¶…å‡º foobar2000
3. âœ… **å®ç°ç®€æ´**: æ˜“äºç†è§£å’Œç»´æŠ¤
4. âœ… **èµ„æºæ•ˆç‡**: æä½çš„ CPU å’Œå†…å­˜ä½¿ç”¨

#### Qoder foobar ä¸è¶³
1. âš ï¸ **ç²¾åº¦æœ‰é™**: THD å’Œ SNR ä¸ä¸“ä¸šçº§æœ‰è¾ƒå¤§å·®è·
2. âš ï¸ **éŸ³è´¨ä¸€èˆ¬**: ä¸é€‚åˆä¸“ä¸šéŸ³é¢‘åº”ç”¨
3. âš ï¸ **åŠŸèƒ½å•ä¸€**: ç¼ºå°‘è´¨é‡é…ç½®é€‰é¡¹
4. âš ï¸ **æŠ—æ··å å·®**: é«˜é¢‘å¤±çœŸæ˜æ˜¾

### 8.2 ç­–ç•¥å»ºè®®

#### é˜¶æ®µä¸€ï¼šå¿«é€Ÿæ”¹è¿›ï¼ˆ1-2å‘¨ï¼‰
1. æ·»åŠ ç®€å•çš„æŠ—æ··å æ»¤æ³¢å™¨
2. å®ç°ä¸‰æ¬¡æ’å€¼ç®—æ³•
3. æä¾›åŸºç¡€çš„è´¨é‡é€‰é¡¹

#### é˜¶æ®µäºŒï¼šä¸“ä¸šçº§é›†æˆï¼ˆ1-2æœˆï¼‰
1. é›†æˆ libsamplerate
2. å®ç°å¤šè´¨é‡ç­‰çº§
3. ä¼˜åŒ–ç¼“å­˜å’Œæ€§èƒ½

#### é˜¶æ®µä¸‰ï¼šåˆ›æ–°åŠŸèƒ½ï¼ˆ3-6æœˆï¼‰
1. è‡ªé€‚åº”è´¨é‡ç³»ç»Ÿ
2. GPU åŠ é€Ÿæ”¯æŒ
3. æœºå™¨å­¦ä¹ å¢å¼º

### 8.3 æœ€ç»ˆå»ºè®®

**å¯¹äºå½“å‰å®ç°**ï¼š
- âœ… é€‚åˆå®æ—¶åº”ç”¨å’Œéä¸“ä¸šåœºæ™¯
- âœ… å¯ä»¥ä½œä¸ºè½»é‡çº§é€‰é¡¹ä¿ç•™
- âœ… å»ºè®®æ·»åŠ è´¨é‡è­¦å‘Šæç¤º

**å¯¹äºæœªæ¥å‘å±•**ï¼š
- ğŸ¯ ä¼˜å…ˆé›†æˆé«˜è´¨é‡ç®—æ³•ï¼ˆlibsamplerateï¼‰
- ğŸ¯ æä¾›å¯é…ç½®çš„è´¨é‡é€‰é¡¹
- ğŸ¯ ä¿æŒé«˜æ€§èƒ½ç‰ˆæœ¬çš„å¯ç”¨æ€§

### 8.4 ç«äº‰åŠ›åˆ†æ

é€šè¿‡ä¸ foobar2000 çš„å¯¹æ¯”ï¼ŒQoder foobar åœ¨æ€§èƒ½å’Œç ç‡è¦†ç›–æ–¹é¢æœ‰ä¼˜åŠ¿ï¼Œä½†åœ¨éŸ³è´¨ç²¾åº¦æ–¹é¢éœ€è¦åŠ å¼ºã€‚å»ºè®®é‡‡ç”¨**åŒå¼•æ“ç­–ç•¥**ï¼š

1. **å¿«é€Ÿå¼•æ“**: å½“å‰çš„çº¿æ€§æ’å€¼ï¼Œç”¨äºå®æ—¶åº”ç”¨
2. **è´¨é‡å¼•æ“**: é›†æˆçš„é«˜è´¨é‡ç®—æ³•ï¼Œç”¨äºä¸“ä¸šåº”ç”¨

è¿™æ ·å¯ä»¥åœ¨ä¿æŒæ€§èƒ½ä¼˜åŠ¿çš„åŒæ—¶ï¼Œæä¾›ä¸“ä¸šçº§çš„éŸ³è´¨é€‰æ‹©ã€‚

---

*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: 2025-12-10*
*å¯¹æ¯”åŸºå‡†: Qoder foobar v0.3.0 vs foobar2000 v2.0*
*æµ‹è¯•ç¯å¢ƒ: Linux x86_64, Intel i7-12700K*